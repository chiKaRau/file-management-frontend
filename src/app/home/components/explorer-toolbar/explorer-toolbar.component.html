<div class="toolbar-container">
    <!-- Row 1: nav + path (left)  |  search (right) -->
    <div class="row row-primary">
        <div class="left">
            <!-- Navigation Buttons -->
            <button (click)="onBack()" [disabled]="isPreloadComplete || !canGoBack">←</button>
            <button (click)="onForward()" [disabled]="isPreloadComplete || !canGoForward">→</button>
            <button (click)="onRefresh()" [disabled]="isPreloadComplete">⟳</button>

            <!-- Path (breadcrumbs OR edit) -->
            <div class="path">
                <!-- Breadcrumbs -->
                <div class="breadcrumb-view" *ngIf="!isEditingPath" (click)="enterEditMode()">
                    <ng-container *ngFor="let part of truncatedBreadcrumbs; let i = index">
                        <span class="breadcrumb-part" (click)="onBreadcrumbClick(i, $event)">{{ part }}</span>
                        <span class="separator" *ngIf="i < truncatedBreadcrumbs.length - 1">></span>
                    </ng-container>
                </div>

                <!-- Path edit -->
                <div *ngIf="isEditingPath" class="edit-view">
                    <input type="text" class="path-input" [value]="currentPath" [disabled]="isPreloadComplete"
                        (keyup.enter)="onPathEnter($any($event.target).value)"
                        (blur)="exitEditMode($any($event.target).value)" autofocus />
                </div>
            </div>
        </div>

        <!-- Search (always pinned right) -->
        <div class="right search-container">
            <input type="text" placeholder="Search files..." (input)="onSearchChange($any($event.target).value)" />
        </div>
    </div>

    <!-- Row 2: utility controls -->
    <div class="row row-secondary">
        <!-- Auto-update + manual update -->
        <div class="update-checkbox">
            <label>
                <input type="checkbox" [(ngModel)]="explorerState.updateLocalPathEnabled" />
                Auto Update Info to DB
            </label>
            <button (click)="onManualUpdate()" [disabled]="isPreloadComplete || !explorerState.selectedDirectory">
                Update Path
            </button>
        </div>

        <!-- Zip toggle -->
        <div class="sidebar-toggle-container">
            <button (click)="toggleZipSidebar()">Zip</button>
        </div>

        <!-- Update all models -->
        <div class="update-models-button">
            <button (click)="onUpdateAllModels()">Update All Models</button>
        </div>

        <!-- Sub-directory navigator -->
        <div class="subdir-nav" *ngIf="displayedSubDirectories.length > 0">
            <select [(ngModel)]="selectedSubdirIndex" (ngModelChange)="onSubdirChange($event)"
                [disabled]="isPreloadComplete">
                <option *ngFor="let dir of displayedSubDirectories; let i = index" [value]="i">
                    {{ dir.name }}
                    <span *ngIf="dir.lastAccessedAt">
                        (Last access: {{ dir.lastAccessedAt | date:'yyyy-MM-dd HH:mm' }})
                    </span>
                </option>
            </select>


            <button (click)="prevSubdir()" [disabled]="isPreloadComplete || selectedSubdirIndex <= 0">←</button>
            <button (click)="nextSubdir()"
                [disabled]="isPreloadComplete || selectedSubdirIndex >= displayedSubDirectories.length - 1">
                →
            </button>

            <label class="lock-checkbox">
                <input type="checkbox" [(ngModel)]="lockEnabled" (ngModelChange)="onLockChange($event)" />
                Lock
            </label>

            <span class="locked-label" *ngIf="lockEnabled">Locked: {{ lockedDirName }}</span>
        </div>
    </div>
</div>