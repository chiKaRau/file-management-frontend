<div class="content">
    <!-- Sticky/top area (doesn't scroll) -->
    <div class="summary">
        <p><strong>Name:</strong> <span class="mono break-anywhere" title="{{ item?.name }}">{{ item?.name }}</span></p>
        <p><strong>Path:</strong> {{ item?.path }}</p>

        <!-- While searching -->
        <ng-container *ngIf="searching">
            <p>Searching... <span class="spinner"></span></p>
            <p>{{ progressMessage }}</p>
            <p>Matches found so far: {{ foundItems.length }}</p>
            <p>Elapsed time: {{ elapsedTime | number:'1.3-3' }} seconds</p>
        </ng-container>

        <!-- Short meta after search -->
        <ng-container *ngIf="!searching">
            <p *ngIf="groupedItems.length > 0">Found Sets: <b>{{ groupedItems.length }}</b></p>
            <p *ngIf="finalElapsedTime !== null">
                Search completed in {{ finalElapsedTime | number:'1.3-3' }} seconds.
            </p>
        </ng-container>
    </div>

    <!-- Scrollable results area -->
    <div class="results">
        <ng-container *ngIf="!searching">
            <ul *ngIf="groupedItems.length > 0">
                <li *ngFor="let set of groupedItems" style="margin-bottom: 1rem;">

                    <p><strong>Set:</strong> <span class="mono break-anywhere" title="{{ set.setId }}">{{ set.setId
                            }}</span></p>

                    <p *ngIf="set.existsInDb" class="db-pill">Existed in DB</p>

                    <p *ngIf="itemVersionId && versionFrom(set)">
                        <strong>VersionID:</strong>
                        <b>{{ versionFrom(set) }}</b> -> <b>{{ itemVersionId }}</b>
                    </p>

                    <p *ngIf="itemBaseModel && baseFrom(set)">
                        <strong>BaseModel:</strong>
                        <span class="match-pill" [class.ok]="baseModelMatches(set)"
                            [class.bad]="!baseModelMatches(set)">
                            {{ baseModelMatches(set) ? 'Match' : 'Not Match' }}
                        </span>
                    </p>

                    <p><strong>ZIP:</strong> {{ set.isZip ? 'Yes' : 'No' }}</p>

                    <p *ngIf="set.folderPath">
                        <strong>Folder:</strong>
                        <span class="mono linklike" (click)="$event.stopPropagation(); revealFolder(set.folderPath!)"
                            title="Open in file explorer">
                            {{ set.folderPath }}
                        </span>
                        <button class="btn btn--ghost btn--sm"
                            (click)="$event.stopPropagation(); copyText(set.folderPath!)">Copy</button>
                    </p>

                    <div *ngIf="set.previewPath">
                        <img [src]="set.previewPath" alt="{{ set.setId }}"
                            style="max-width:200px; max-height:200px; display:block; margin: 0.5rem 0;">
                    </div>
                    <p *ngIf="!set.previewPath">No preview available.</p>

                    <p *ngIf="getModelLink(set.setId)">
                        <a [href]="getModelLink(set.setId)" target="_blank" rel="noopener noreferrer">Go to Model</a>
                    </p>

                    <div class="actions">
                        <button class="action-btn upgrade" (click)="upgradeSet(set)"
                            [disabled]="set.isProcessing">Upgrade</button>
                        <button class="action-btn add" (click)="addToLocation(set)" [disabled]="set.isProcessing">Add to
                            location</button>
                        <button class="action-btn delete" (click)="deleteSet(set)"
                            [disabled]="set.isProcessing">Delete</button>
                    </div>

                    <div *ngIf="set.isProcessing">
                        <progress [value]="set.moveProgress" max="100"></progress>
                        <span>{{ set.moveProgress }}%</span>
                    </div>
                </li>
            </ul>

            <p *ngIf="groupedItems.length === 0">No matches found.</p>
        </ng-container>
    </div>
</div>