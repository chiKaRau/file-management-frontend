<div class="virtual-toolbar">
    <!-- Row 1: nav + path + drive (left) | search (right) -->
    <div class="row row-primary">
        <div class="left">
            <div class="nav-buttons">
                <button (click)="onBack()" [disabled]="isPreloadComplete || !canGoBack">←</button>
                <button (click)="onForward()" [disabled]="isPreloadComplete || !canGoForward">→</button>
                <button (click)="onRefresh()" [disabled]="isPreloadComplete">⟳</button>
            </div>

            <!-- Breadcrumb / Path -->
            <div class="breadcrumb-section">
                <div class="breadcrumb-view" *ngIf="!isEditingPath" (click)="enterEditMode()">
                    <ng-container *ngFor="let crumb of truncatedBreadcrumbs; let i = index">
                        <span class="breadcrumb-part" (click)="onBreadcrumbClick(i, $event)">{{ crumb }}</span>
                        <span class="separator" *ngIf="i < truncatedBreadcrumbs.length - 1">></span>
                    </ng-container>
                </div>

                <div class="edit-view" *ngIf="isEditingPath">
                    <input #pathInput type="text" class="path-input" [value]="displayedPath"
                        [disabled]="isPreloadComplete" (keyup.enter)="onPathEnter(pathInput.value)"
                        (blur)="exitEditMode(pathInput.value)" autofocus />
                </div>
            </div>

            <!-- Drive dropdown -->
            <div class="drive-dropdown">
                <select [value]="selectedDrive" (change)="onDriveChange($event)">
                    <option value="all">All Drives</option>
                    <option *ngFor="let drive of availableDrives" [value]="drive">{{ drive }}</option>
                </select>
            </div>
        </div>

        <!-- Search (always pinned right) -->
        <div class="right search-container">
            <input #searchInput type="text" placeholder="Search files..." (input)="onSearchChange(searchInput.value)"
                [value]="searchText" />

            <!-- Deep Search -->
            <div class="deep-search">
                <input #deepInput type="text" placeholder="Deep search (space/comma tags)"
                    [disabled]="isPreloadComplete" (keyup.enter)="onDeepSearch(deepInput.value)" />

                <!-- Icon search button -->
                <button class="btn btn-icon" [disabled]="isPreloadComplete" (click)="onDeepSearch(deepInput.value)"
                    aria-label="Deep search">
                    <!-- magnifying glass -->
                    <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                        <path
                            d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 5 1.5-1.5-5-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
                    </svg>
                </button>

                <!-- Clear button -->
                <button class="btn btn-icon" (click)="onDeepClearClick(deepInput)" [disabled]="isPreloadComplete"
                    aria-label="Clear deep search">
                    <!-- close (X) -->
                    <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                        <path
                            d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                    </svg>
                </button>

                <!-- Help / How-to popover -->
                <div class="help-popover-wrapper" (mouseenter)="openHelp()" (mouseleave)="scheduleHelpClose()"
                    (focusin)="openHelp()" (focusout)="scheduleHelpClose()" (keydown)="onHelpKeydown($event)"
                    tabindex="0" aria-haspopup="dialog" [attr.aria-expanded]="helpOpen">

                    <button class="btn btn-icon help-icon" type="button" aria-label="How to Search">
                        <!-- ? in a circle -->
                        <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                            <path
                                d="M12 2a10 10 0 1 0 .001 20.001A10 10 0 0 0 12 2zm0 17a1.25 1.25 0 1 1 0-2.5 1.25 1.25 0 0 1 0 2.5zm1.22-5.64-.46.34V15h-1.5v-2.04c0-.39.18-.76.49-1l.95-.71c.41-.31.65-.8.65-1.32A1.83 1.83 0 0 0 11.52 6a1.86 1.86 0 0 0-1.87 1.87H8.15A3.37 3.37 0 0 1 11.52 4.5c1.87 0 3.37 1.5 3.37 3.37 0 1.06-.5 2.05-1.67 2.49z" />
                        </svg>
                    </button>

                    <div class="search-help-popover" *ngIf="helpOpen" role="dialog" aria-label="How to Search">
                        <div class="arrow" aria-hidden="true"></div>
                        <h4>How to Search</h4>
                        <ul class="examples examples--plain">
                            <li><span class="ex-title">Texts (Name/ID#) contains</span> <code>anime</code></li>
                            <li><span class="ex-title">Multiple Texts</span> <code>anime 1516234</code></li>
                            <li><span class="ex-title">Specific column</span> <code>creator:"noch"</code>
                            </li>
                            <li><span class="ex-title">Multiple specific columns</span>
                                <code>creator:"noch" mainModelName:"nakano"</code>
                            </li>
                            <li><span class="ex-title">Specific columns and Texts</span>
                                <code>mainModelName:"nakano" 158</code>
                            </li>
                            <li><span class="ex-title">Multiple tags/triggers/aliaes</span>
                                <code>tags:"anime" tags:"one piece"</code>
                            </li>
                        </ul>
                    </div>
                </div>


            </div>

        </div>
    </div>

    <!-- Row 2: actions -->
    <div class="row row-secondary">
        <div class="update-models-button">
            <button (click)="onUpdateStats()" [disabled]="isPreloadComplete">
                Update All Models
            </button>
        </div>
    </div>
</div>